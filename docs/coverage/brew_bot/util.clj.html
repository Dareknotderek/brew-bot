<html>
 <head>
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <link rel="stylesheet" href="../coverage.css"/>  <title> brew_bot/util.clj </title>
 </head>
 <body>
<span class="covered" title="1 out of 1 forms covered">
                001&nbsp;&nbsp;(ns&nbsp;brew-bot.util
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                002&nbsp;&nbsp;&nbsp;&nbsp;&quot;Common&nbsp;fns&nbsp;required&nbsp;across&nbsp;recipe&nbsp;generation&nbsp;strategies&quot;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                003&nbsp;&nbsp;&nbsp;&nbsp;(:require&nbsp;[bigml.sampling.simple&nbsp;:as&nbsp;bss]
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                004&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[brew-bot.ingredients&nbsp;:as&nbsp;ingredients]))
                </span><br/>
<span class="blank" title="0 out of 0 forms covered">
                005&nbsp;&nbsp;
                </span><br/>
<span class="covered" title="1 out of 1 forms covered">
                006&nbsp;&nbsp;(defn&nbsp;rand-key
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                007&nbsp;&nbsp;&nbsp;&nbsp;&quot;Pick&nbsp;a&nbsp;random&nbsp;key&nbsp;from&nbsp;a&nbsp;map,&nbsp;weighted&nbsp;by&nbsp;the&nbsp;:probability&nbsp;key&nbsp;of&nbsp;the&nbsp;value&quot;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                008&nbsp;&nbsp;&nbsp;&nbsp;[m]
                </span><br/>
<span class="partial" title="21 out of 22 forms covered">
                009&nbsp;&nbsp;&nbsp;&nbsp;(first&nbsp;(bss&#x2F;sample&nbsp;(keys&nbsp;m)&nbsp;:replace&nbsp;true&nbsp;:weigh&nbsp;#(or&nbsp;(:probability&nbsp;(get&nbsp;m&nbsp;%))&nbsp;1))))
                </span><br/>
<span class="blank" title="0 out of 0 forms covered">
                010&nbsp;&nbsp;
                </span><br/>
<span class="covered" title="1 out of 1 forms covered">
                011&nbsp;&nbsp;(defn&nbsp;join-ingredient-maps
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                012&nbsp;&nbsp;&nbsp;&nbsp;&quot;Given&nbsp;an&nbsp;ingredient&nbsp;map,&nbsp;lookup&nbsp;the&nbsp;source&nbsp;ingredient&nbsp;and&nbsp;combine&nbsp;it&nbsp;with&nbsp;the&nbsp;added-key&quot;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                013&nbsp;&nbsp;&nbsp;&nbsp;[ingredient-bill&nbsp;ingredient-source&nbsp;added-key]
                </span><br/>
<span class="covered" title="17 out of 17 forms covered">
                014&nbsp;&nbsp;&nbsp;&nbsp;(reduce-kv&nbsp;(fn&nbsp;[m&nbsp;k&nbsp;v]&nbsp;(assoc&nbsp;m&nbsp;k&nbsp;(assoc&nbsp;(get&nbsp;ingredient-source&nbsp;k)&nbsp;added-key&nbsp;v)))&nbsp;{}&nbsp;ingredient-bill))
                </span><br/>
<span class="blank" title="0 out of 0 forms covered">
                015&nbsp;&nbsp;
                </span><br/>
<span class="covered" title="1 out of 1 forms covered">
                016&nbsp;&nbsp;(defn&nbsp;update-or-assoc
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                017&nbsp;&nbsp;&nbsp;&nbsp;&quot;If&nbsp;`k`&nbsp;exists&nbsp;in&nbsp;`m`&nbsp;apply&nbsp;the&nbsp;`update-fn`.
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                018&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Else,&nbsp;assoc&nbsp;`v`&nbsp;to&nbsp;that&nbsp;`k`&nbsp;in&nbsp;`m`&quot;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                019&nbsp;&nbsp;&nbsp;&nbsp;[m&nbsp;k&nbsp;v&nbsp;update-fn]
                </span><br/>
<span class="covered" title="5 out of 5 forms covered">
                020&nbsp;&nbsp;&nbsp;&nbsp;(if&nbsp;(get&nbsp;m&nbsp;k)
                </span><br/>
<span class="covered" title="5 out of 5 forms covered">
                021&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(update&nbsp;m&nbsp;k&nbsp;update-fn)
                </span><br/>
<span class="covered" title="5 out of 5 forms covered">
                022&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(assoc&nbsp;m&nbsp;k&nbsp;v)))
                </span><br/>
<span class="blank" title="0 out of 0 forms covered">
                023&nbsp;&nbsp;
                </span><br/>
<span class="covered" title="1 out of 1 forms covered">
                024&nbsp;&nbsp;(defn&nbsp;scale-ingredients
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                025&nbsp;&nbsp;&nbsp;&nbsp;&quot;Update&nbsp;`ingredient-map`&nbsp;so&nbsp;the&nbsp;combined&nbsp;:weights&nbsp;are&nbsp;randomly&nbsp;scaled&nbsp;up&nbsp;to&nbsp;`weight-limit`&quot;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                026&nbsp;&nbsp;&nbsp;&nbsp;[ingredient-map&nbsp;weight-limit]
                </span><br/>
<span class="covered" title="2 out of 2 forms covered">
                027&nbsp;&nbsp;&nbsp;&nbsp;(loop&nbsp;[i-map&nbsp;ingredient-map
                </span><br/>
<span class="covered" title="7 out of 7 forms covered">
                028&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;weight&nbsp;(reduce&nbsp;+&nbsp;0&nbsp;(vals&nbsp;ingredient-map))]
                </span><br/>
<span class="covered" title="5 out of 5 forms covered">
                029&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(if&nbsp;(&lt;&nbsp;weight&nbsp;weight-limit)
                </span><br/>
<span class="covered" title="4 out of 4 forms covered">
                030&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(let&nbsp;[addition&nbsp;(rand-nth&nbsp;ingredients&#x2F;ingredient-amounts)
                </span><br/>
<span class="covered" title="5 out of 5 forms covered">
                031&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mod-ingredient&nbsp;(rand-nth&nbsp;(keys&nbsp;i-map))]
                </span><br/>
<span class="covered" title="1 out of 1 forms covered">
                032&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(recur&nbsp;(update&nbsp;i-map&nbsp;mod-ingredient&nbsp;+&nbsp;addition)
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                033&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(+&nbsp;weight&nbsp;addition)))
                </span><br/>
<span class="covered" title="1 out of 1 forms covered">
                034&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i-map)))
                </span><br/>
<span class="blank" title="0 out of 0 forms covered">
                035&nbsp;&nbsp;
                </span><br/>
<span class="covered" title="1 out of 1 forms covered">
                036&nbsp;&nbsp;(defn&nbsp;potential-gravity-to-gravity-points
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                037&nbsp;&nbsp;&nbsp;&nbsp;[potential-og&nbsp;weight]
                </span><br/>
<span class="covered" title="2 out of 2 forms covered">
                038&nbsp;&nbsp;&nbsp;&nbsp;(-&gt;&nbsp;potential-og
                </span><br/>
<span class="covered" title="3 out of 3 forms covered">
                039&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(*&nbsp;1000)
                </span><br/>
<span class="covered" title="3 out of 3 forms covered">
                040&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(-&nbsp;1000)
                </span><br/>
<span class="covered" title="2 out of 2 forms covered">
                041&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(*&nbsp;weight)))
                </span><br/>
<span class="blank" title="0 out of 0 forms covered">
                042&nbsp;&nbsp;
                </span><br/>
<span class="covered" title="1 out of 1 forms covered">
                043&nbsp;&nbsp;(defn&nbsp;gravity-points-to-potential-gravity
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                044&nbsp;&nbsp;&nbsp;&nbsp;[og-points&nbsp;gallons]
                </span><br/>
<span class="covered" title="4 out of 4 forms covered">
                045&nbsp;&nbsp;&nbsp;&nbsp;(-&gt;&nbsp;og-points
                </span><br/>
<span class="covered" title="3 out of 3 forms covered">
                046&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&#x2F;&nbsp;gallons)
                </span><br/>
<span class="covered" title="3 out of 3 forms covered">
                047&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(+&nbsp;1000)
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                048&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&#x2F;&nbsp;1000.0)))
                </span><br/>
<span class="blank" title="0 out of 0 forms covered">
                049&nbsp;&nbsp;
                </span><br/>
<span class="covered" title="1 out of 1 forms covered">
                050&nbsp;&nbsp;(defn&nbsp;calculate-gravity
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                051&nbsp;&nbsp;&nbsp;&nbsp;([gallons&nbsp;grains&nbsp;extracts]
                </span><br/>
<span class="covered" title="6 out of 6 forms covered">
                052&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(calculate-gravity&nbsp;gallons&nbsp;grains&nbsp;extracts&nbsp;0.7))&nbsp;;;&nbsp;We&nbsp;assume&nbsp;a&nbsp;mashing&nbsp;efficiency&nbsp;of&nbsp;70%&nbsp;on&nbsp;average&nbsp;https:&#x2F;&#x2F;beerandbrewing.com&#x2F;ask-the-experts-mash-efficiency&#x2F;
                </span><br/>
<span class="blank" title="0 out of 0 forms covered">
                053&nbsp;&nbsp;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                054&nbsp;&nbsp;&nbsp;&nbsp;([gallons&nbsp;grains&nbsp;extracts&nbsp;efficiency]
                </span><br/>
<span class="covered" title="24 out of 24 forms covered">
                055&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(let&nbsp;[grains-gravity&nbsp;&nbsp;&nbsp;&nbsp;(*&nbsp;efficiency&nbsp;(reduce&nbsp;+&nbsp;0.0&nbsp;(map&nbsp;#(potential-gravity-to-gravity-points&nbsp;(:gravity&nbsp;(second&nbsp;%))&nbsp;(:weight&nbsp;(second&nbsp;%)))&nbsp;grains)))
                </span><br/>
<span class="covered" title="20 out of 20 forms covered">
                056&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;extracts-gravity&nbsp;&nbsp;(reduce&nbsp;+&nbsp;0.0&nbsp;(map&nbsp;#(potential-gravity-to-gravity-points&nbsp;(:gravity&nbsp;(second&nbsp;%))&nbsp;(:weight&nbsp;(second&nbsp;%)))&nbsp;extracts))]
                </span><br/>
<span class="covered" title="7 out of 7 forms covered">
                057&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(gravity-points-to-potential-gravity&nbsp;(+&nbsp;grains-gravity&nbsp;extracts-gravity)&nbsp;gallons))))
                </span><br/>
 </body>
</html>
